<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using ollamar • ollamar</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using ollamar">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ollamar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/ollamar.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/hauselin/ollama-r/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using ollamar</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/hauselin/ollama-r/blob/v1.2.2/vignettes/ollamar.Rmd" class="external-link"><code>vignettes/ollamar.Rmd</code></a></small>
      <div class="d-none name"><code>ollamar.Rmd</code></div>
    </div>

    
    
<p>ollamar is the easiest way to integrate R with <a href="https://ollama.com/" class="external-link">Ollama</a>, which lets you run language
models locally on your own machine.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Download and install the <a href="https://ollama.com" class="external-link">Ollama</a>
app.</li>
</ol>
<ul>
<li><a href="https://ollama.com/download/Ollama-darwin.zip" class="external-link">macOS</a></li>
<li><a href="https://ollama.com/download/OllamaSetup.exe" class="external-link">Windows
preview</a></li>
<li>Linux:
<code>curl -fsSL https://ollama.com/install.sh | sh</code>
</li>
<li><a href="https://hub.docker.com/r/ollama/ollama" class="external-link">Docker
image</a></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><p>Open/launch the Ollama app to start the local server.</p></li>
<li><p>Install either the stable or latest/development version of
<code>ollamar</code>.</p></li>
</ol>
<p>Stable version:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ollamar"</span><span class="op">)</span></span></code></pre></div>
<p>For the latest/development version with more features/bug fixes (see
latest changes <a href="https://hauselin.github.io/ollama-r/news/index.html">here</a>),
you can install it from GitHub using the <code>install_github</code>
function from the <code>remotes</code> library. If it doesn’t work or
you don’t have <code>remotes</code> library, please run
<code>install.packages("remotes")</code> in R or RStudio before running
the code below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")  # run this line if you don't have the remotes library</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"hauselin/ollamar"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p><code>ollamar</code> uses the <a href="https://httr2.r-lib.org/index.html" class="external-link"><code>httr2</code> library</a>
to make HTTP requests to the Ollama server, so many functions in this
library returns an <code>httr2_response</code> object by default. If the
response object says <code>Status: 200 OK</code>, then the request was
successful.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">library</span>(ollamar)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">test_connection</span>()  <span class="co"># test connection to Ollama server</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># if you see "Ollama local server not running or wrong server," Ollama app/server isn't running</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co"># generate a response/text based on a prompt; returns an httr2 response by default</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>resp <span class="ot">&lt;-</span> <span class="fu">generate</span>(<span class="st">"llama3.1"</span>, <span class="st">"tell me a 5-word story"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>resp</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#' interpret httr2 response object</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#' &lt;httr2_response&gt;</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#' Status: 200 OK  # if successful, status code should be 200 OK</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#' Content-Type: application/json</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#' Body: In memory (414 bytes)</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co"># get just the text from the response object</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="fu">resp_process</span>(resp, <span class="st">"text"</span>)</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co"># get the text as a tibble dataframe</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="fu">resp_process</span>(resp, <span class="st">"df"</span>)</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="co"># alternatively, specify the output type when calling the function initially</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>txt <span class="ot">&lt;-</span> <span class="fu">generate</span>(<span class="st">"llama3.1"</span>, <span class="st">"tell me a 5-word story"</span>, <span class="at">output =</span> <span class="st">"text"</span>)</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="co"># list available models (models you've pulled/downloaded)</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="fu">list_models</span>()</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>                        name    size parameter_size quantization_level            modified</span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="dv">1</span>               codegemma<span class="sc">:</span><span class="dv">7</span>b    <span class="dv">5</span> GB             <span class="dv">9</span>B               Q4_0 <span class="dv">2024-07-27</span>T23<span class="sc">:</span><span class="dv">44</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="dv">2</span>            llama3<span class="fl">.1</span><span class="sc">:</span>latest  <span class="fl">4.7</span> GB           <span class="fl">8.0</span>B               Q4_0 <span class="dv">2024-07-31</span>T07<span class="sc">:</span><span class="dv">44</span><span class="sc">:</span><span class="dv">33</span></span></code></pre></div>
<div class="section level3">
<h3 id="pulldownload-model">Pull/download model<a class="anchor" aria-label="anchor" href="#pulldownload-model"></a>
</h3>
<p>Download a model from the ollama library (see <a href="https://github.com/ollama/ollama/blob/main/docs/api.md#pull-a-model" class="external-link">API
doc</a>). For the list of models you can pull/download, see <a href="https://ollama.com/library" class="external-link">Ollama library</a>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pull.html">pull</a></span><span class="op">(</span><span class="st">"llama3.1"</span><span class="op">)</span>  <span class="co"># download a model (equivalent bash code: ollama run llama3.1)</span></span>
<span><span class="fu"><a href="../reference/list_models.html">list_models</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># verify you've pulled/downloaded the model</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="delete-model">Delete model<a class="anchor" aria-label="anchor" href="#delete-model"></a>
</h3>
<p>Delete a model and its data (see <a href="https://github.com/ollama/ollama/blob/main/docs/api.md#delete-a-model" class="external-link">API
doc</a>). You can see what models you’ve downloaded with
<code><a href="../reference/list_models.html">list_models()</a></code>. To download a model, specify the name of the
model.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_models.html">list_models</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># see the models you've pulled/downloaded</span></span>
<span><span class="fu"><a href="../reference/delete.html">delete</a></span><span class="op">(</span><span class="st">"all-minilm:latest"</span><span class="op">)</span>  <span class="co"># returns a httr2 response object</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generate-completion">Generate completion<a class="anchor" aria-label="anchor" href="#generate-completion"></a>
</h3>
<p>Generate a response for a given prompt (see <a href="https://github.com/ollama/ollama/blob/main/docs/api.md#generate-a-completion" class="external-link">API
doc</a>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate.html">generate</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="st">"Tomorrow is a..."</span><span class="op">)</span>  <span class="co"># return httr2 response object by default</span></span>
<span><span class="va">resp</span></span>
<span></span>
<span><span class="fu"><a href="../reference/resp_process.html">resp_process</a></span><span class="op">(</span><span class="va">resp</span>, <span class="st">"text"</span><span class="op">)</span>  <span class="co"># process the response to return text/vector output</span></span>
<span></span>
<span><span class="fu"><a href="../reference/generate.html">generate</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="st">"Tomorrow is a..."</span>, output <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span>  <span class="co"># directly return text/vector output</span></span>
<span><span class="fu"><a href="../reference/generate.html">generate</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="st">"Tomorrow is a..."</span>, stream <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  <span class="co"># return httr2 response object and stream output</span></span>
<span><span class="fu"><a href="../reference/generate.html">generate</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="st">"Tomorrow is a..."</span>, output <span class="op">=</span> <span class="st">"df"</span>, stream <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># image prompt</span></span>
<span><span class="co"># use a vision/multi-modal model</span></span>
<span><span class="fu"><a href="../reference/generate.html">generate</a></span><span class="op">(</span><span class="st">"benzie/llava-phi-3"</span>, <span class="st">"What is in the image?"</span>, images <span class="op">=</span> <span class="st">"image.png"</span>, output <span class="op">=</span> <span class="st">'text'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="chat">Chat<a class="anchor" aria-label="anchor" href="#chat"></a>
</h3>
<p>Generate the next message in a chat/conversation.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">messages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span><span class="st">"what is the capital of australia"</span><span class="op">)</span>  <span class="co"># default role is user</span></span>
<span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="va">messages</span><span class="op">)</span>  <span class="co"># default returns httr2 response object</span></span>
<span><span class="va">resp</span>  <span class="co"># &lt;httr2_response&gt;</span></span>
<span><span class="fu"><a href="../reference/resp_process.html">resp_process</a></span><span class="op">(</span><span class="va">resp</span>, <span class="st">"text"</span><span class="op">)</span>  <span class="co"># process the response to return text/vector output</span></span>
<span></span>
<span><span class="co"># specify output type when calling the function</span></span>
<span><span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="va">messages</span>, output <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span>  <span class="co"># text vector</span></span>
<span><span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="va">messages</span>, output <span class="op">=</span> <span class="st">"df"</span><span class="op">)</span>  <span class="co"># data frame/tibble</span></span>
<span><span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="va">messages</span>, output <span class="op">=</span> <span class="st">"jsonlist"</span><span class="op">)</span>  <span class="co"># list</span></span>
<span><span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="va">messages</span>, output <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span>  <span class="co"># raw string</span></span>
<span><span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="va">messages</span>, stream <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  <span class="co"># stream output and return httr2 response object</span></span>
<span></span>
<span><span class="co"># create chat history</span></span>
<span><span class="va">messages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_messages.html">create_messages</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span><span class="st">"end all your sentences with !!!"</span>, role <span class="op">=</span> <span class="st">"system"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span><span class="st">"Hello!"</span><span class="op">)</span>,  <span class="co"># default role is user</span></span>
<span>  <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span><span class="st">"Hi, how can I help you?!!!"</span>, role <span class="op">=</span> <span class="st">"assistant"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span><span class="st">"What is the capital of Australia?"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span><span class="st">"Canberra!!!"</span>, role <span class="op">=</span> <span class="st">"assistant"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span><span class="st">"what is your name?"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="va">messages</span>, output <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># print the formatted output</span></span>
<span></span>
<span><span class="co"># image prompt</span></span>
<span><span class="va">messages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span><span class="st">"What is in the image?"</span>, images <span class="op">=</span> <span class="st">"image.png"</span><span class="op">)</span></span>
<span><span class="co"># use a vision/multi-modal model</span></span>
<span><span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="st">"benzie/llava-phi-3"</span>, <span class="va">messages</span>, output <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="stream-responses">Stream responses<a class="anchor" aria-label="anchor" href="#stream-responses"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">messages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span><span class="st">"Tell me a 1-paragraph story."</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use "llama3.1" model, provide list of messages, return text/vector output, and stream the output</span></span>
<span><span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="va">messages</span>, output <span class="op">=</span> <span class="st">"text"</span>, stream <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># chat(model = "llama3.1", messages = messages, output = "text", stream = TRUE)  # same as above</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="format-messages-for-chat">Format messages for chat<a class="anchor" aria-label="anchor" href="#format-messages-for-chat"></a>
</h4>
<p>Internally, messages are represented as a <code>list</code> of many
distinct <code>list</code> messages. Each list/message object has two
elements: <code>role</code> (can be <code>"user"</code> or
<code>"assistant"</code> or <code>"system"</code>) and
<code>content</code> (the message text). The example below shows how the
messages/lists are presented.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>  <span class="co"># main list containing all the messages</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>role <span class="op">=</span> <span class="st">"user"</span>, content <span class="op">=</span> <span class="st">"Hello!"</span><span class="op">)</span>,  <span class="co"># first message as a list</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>role <span class="op">=</span> <span class="st">"assistant"</span>, content <span class="op">=</span> <span class="st">"Hi! How are you?"</span><span class="op">)</span>  <span class="co"># second message as a list</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>To simplify the process of creating and managing messages,
<code>ollamar</code> provides functions to format and prepare messages
for the <code><a href="../reference/chat.html">chat()</a></code> function. These functions also work with
other APIs or LLM providers like OpenAI and Anthropic.</p>
<ul>
<li>
<code><a href="../reference/create_messages.html">create_messages()</a></code>: create messages to build a chat
history</li>
<li>
<code><a href="../reference/create_message.html">create_message()</a></code> creates a chat history with a single
message</li>
<li>
<code><a href="../reference/append_message.html">append_message()</a></code> adds a new message to the end of the
existing messages</li>
<li>
<code><a href="../reference/prepend_message.html">prepend_message()</a></code> adds a new message to the beginning
of the existing messages</li>
<li>
<code><a href="../reference/insert_message.html">insert_message()</a></code> inserts a new message at a specific
index in the existing messages
<ul>
<li>by default, it inserts the message at the -1 (final) position</li>
</ul>
</li>
<li>
<code><a href="../reference/delete_message.html">delete_message()</a></code> delete a message at a specific index
in the existing messages
<ul>
<li>positive and negative indices/positions are supported</li>
<li>if there are 5 messages, the positions are 1 (-5), 2 (-4), 3 (-3), 4
(-2), 5 (-1)</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a chat history with one message</span></span>
<span><span class="va">messages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span>content <span class="op">=</span> <span class="st">"Hi! How are you? (1ST MESSAGE)"</span>, role <span class="op">=</span> <span class="st">"assistant"</span><span class="op">)</span></span>
<span><span class="co"># or simply, messages &lt;- create_message("Hi! How are you?", "assistant")</span></span>
<span><span class="va">messages</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>  <span class="co"># get 1st message</span></span>
<span></span>
<span><span class="co"># append (add to the end) a new message to the existing messages</span></span>
<span><span class="va">messages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/append_message.html">append_message</a></span><span class="op">(</span><span class="st">"I'm good. How are you? (2ND MESSAGE)"</span>, <span class="st">"user"</span>, <span class="va">messages</span><span class="op">)</span></span>
<span><span class="va">messages</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>  <span class="co"># get 1st message</span></span>
<span><span class="va">messages</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>  <span class="co"># get 2nd message (newly added message)</span></span>
<span></span>
<span><span class="co"># prepend (add to the beginning) a new message to the existing messages</span></span>
<span><span class="va">messages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepend_message.html">prepend_message</a></span><span class="op">(</span><span class="st">"I'm good. How are you? (0TH MESSAGE)"</span>, <span class="st">"user"</span>, <span class="va">messages</span><span class="op">)</span></span>
<span><span class="va">messages</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>  <span class="co"># get 0th message (newly added message)</span></span>
<span><span class="va">messages</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>  <span class="co"># get 1st message</span></span>
<span><span class="va">messages</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>  <span class="co"># get 2nd message</span></span>
<span></span>
<span><span class="co"># insert a new message at a specific index/position (2nd position in the example below)</span></span>
<span><span class="co"># by default, the message is inserted at the end of the existing messages (position -1 is the end/default)</span></span>
<span><span class="va">messages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/insert_message.html">insert_message</a></span><span class="op">(</span><span class="st">"I'm good. How are you? (BETWEEN 0 and 1 MESSAGE)"</span>, <span class="st">"user"</span>, <span class="va">messages</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">messages</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>  <span class="co"># get 0th message</span></span>
<span><span class="va">messages</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>  <span class="co"># get between 0 and 1 message (newly added message)</span></span>
<span><span class="va">messages</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>  <span class="co"># get 1st message</span></span>
<span><span class="va">messages</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>  <span class="co"># get 2nd message</span></span>
<span></span>
<span><span class="co"># delete a message at a specific index/position (2nd position in the example below)</span></span>
<span><span class="va">messages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/delete_message.html">delete_message</a></span><span class="op">(</span><span class="va">messages</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a chat history with multiple messages</span></span>
<span><span class="va">messages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_messages.html">create_messages</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span><span class="st">"You're a knowledgeable tour guide."</span>, role <span class="op">=</span> <span class="st">"system"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span><span class="st">"What is the capital of Australia?"</span><span class="op">)</span>  <span class="co"># default role is user</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>You can convert <code>data.frame</code>, <code>tibble</code> or
<code>data.table</code> objects to <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> of messages and
vice versa with functions from base R or other popular libraries.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a list of messages</span></span>
<span><span class="va">messages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_messages.html">create_messages</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span><span class="st">"You're a knowledgeable tour guide."</span>, role <span class="op">=</span> <span class="st">"system"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span><span class="st">"What is the capital of Australia?"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert to dataframe</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">bind_rows</span><span class="op">(</span><span class="va">messages</span><span class="op">)</span>  <span class="co"># with dplyr library</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu">rbindlist</span><span class="op">(</span><span class="va">messages</span><span class="op">)</span>  <span class="co"># with data.table library</span></span>
<span></span>
<span><span class="co"># convert dataframe to list with apply, purrr functions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">1</span>, <span class="va">as.list</span><span class="op">)</span>  <span class="co"># convert each row to a list with base R apply</span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/transpose.html" class="external-link">transpose</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>  <span class="co"># with purrr library</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="embeddings">Embeddings<a class="anchor" aria-label="anchor" href="#embeddings"></a>
</h3>
<p>Get the vector embedding of some prompt/text (see <a href="https://github.com/ollama/ollama/blob/main/docs/api.md#generate-embeddings" class="external-link">API
doc</a>). By default, the embeddings are normalized to length 1, which
means the following:</p>
<ul>
<li>cosine similarity can be computed slightly faster using just a dot
product</li>
<li>cosine similarity and Euclidean distance will result in the
identical rankings</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/embed.html">embed</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="st">"Hello, how are you?"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># don't normalize embeddings</span></span>
<span><span class="fu"><a href="../reference/embed.html">embed</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="st">"Hello, how are you?"</span>, normalize <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get embeddings for similar prompts</span></span>
<span><span class="va">e1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/embed.html">embed</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="st">"Hello, how are you?"</span><span class="op">)</span></span>
<span><span class="va">e2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/embed.html">embed</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="st">"Hi, how are you?"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># compute cosine similarity</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">e1</span> <span class="op">*</span> <span class="va">e2</span><span class="op">)</span>  <span class="co"># not equals to 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">e1</span> <span class="op">*</span> <span class="va">e1</span><span class="op">)</span>  <span class="co"># 1 (identical vectors/embeddings)</span></span>
<span></span>
<span><span class="co"># non-normalized embeddings</span></span>
<span><span class="va">e3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/embed.html">embed</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="st">"Hello, how are you?"</span>, normalize <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">e4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/embed.html">embed</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="st">"Hi, how are you?"</span>, normalize <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parse-httr2_response-objects-with-resp_process">Parse <code>httr2_response</code> objects with
<code>resp_process()</code><a class="anchor" aria-label="anchor" href="#parse-httr2_response-objects-with-resp_process"></a>
</h3>
<p><code>ollamar</code> uses the <a href="https://httr2.r-lib.org/index.html" class="external-link"><code>httr2</code> library</a>
to make HTTP requests to the Ollama server, so many functions in this
library returns an <code>httr2_response</code> object by default.</p>
<p>You can either parse the output with <code><a href="../reference/resp_process.html">resp_process()</a></code> or
use the <code>output</code> parameter in the function to specify the
output format. Generally, the <code>output</code> parameter can be one
of <code>"df"</code>, <code>"jsonlist"</code>, <code>"raw"</code>,
<code>"resp"</code>, or <code>"text"</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/list_models.html">list_models</a></span><span class="op">(</span>output <span class="op">=</span> <span class="st">"resp"</span><span class="op">)</span>  <span class="co"># returns a httr2 response object</span></span>
<span><span class="co"># &lt;httr2_response&gt;</span></span>
<span><span class="co"># Status: 200 OK</span></span>
<span><span class="co"># Content-Type: application/json</span></span>
<span></span>
<span><span class="co"># process the httr2 response object with the resp_process() function</span></span>
<span><span class="fu"><a href="../reference/resp_process.html">resp_process</a></span><span class="op">(</span><span class="va">resp</span>, <span class="st">"df"</span><span class="op">)</span></span>
<span><span class="co"># or list_models(output = "df")</span></span>
<span><span class="fu"><a href="../reference/resp_process.html">resp_process</a></span><span class="op">(</span><span class="va">resp</span>, <span class="st">"jsonlist"</span><span class="op">)</span>  <span class="co"># list</span></span>
<span><span class="co"># or list_models(output = "jsonlist")</span></span>
<span><span class="fu"><a href="../reference/resp_process.html">resp_process</a></span><span class="op">(</span><span class="va">resp</span>, <span class="st">"raw"</span><span class="op">)</span>  <span class="co"># raw string</span></span>
<span><span class="co"># or list_models(output = "raw")</span></span>
<span><span class="fu"><a href="../reference/resp_process.html">resp_process</a></span><span class="op">(</span><span class="va">resp</span>, <span class="st">"resp"</span><span class="op">)</span>  <span class="co"># returns the input httr2 response object</span></span>
<span><span class="co"># or list_models() or list_models("resp")</span></span>
<span><span class="fu"><a href="../reference/resp_process.html">resp_process</a></span><span class="op">(</span><span class="va">resp</span>, <span class="st">"text"</span><span class="op">)</span>  <span class="co"># text vector</span></span>
<span><span class="co"># or list_models("text")</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="advanced-usage">Advanced usage<a class="anchor" aria-label="anchor" href="#advanced-usage"></a>
</h2>
<div class="section level3">
<h3 id="tool-calling">Tool calling<a class="anchor" aria-label="anchor" href="#tool-calling"></a>
</h3>
<p>You can use <a href="https://ollama.com/blog/tool-support" class="external-link">tool
calling</a> with the <code><a href="../reference/chat.html">chat()</a></code> function with certain models
such as Llama3.1. See also <a href="https://github.com/ollama/ollama-python/blob/main/examples/tools.py" class="external-link">Python
examples</a>.</p>
<p>First, define your tools as functions. Two example functions are
shown below.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">add_two_numbers</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">multiply_two_numbers</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">a</span> <span class="op">*</span> <span class="va">b</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># each tool needs to be in a list</span></span>
<span><span class="va">tool1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"function"</span>,</span>
<span>              <span class="st">"function"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                name <span class="op">=</span> <span class="st">"add_two_numbers"</span>,  <span class="co"># function name</span></span>
<span>                description <span class="op">=</span> <span class="st">"add two numbers"</span>,</span>
<span>                parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                  type <span class="op">=</span> <span class="st">"object"</span>,</span>
<span>                  required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>,  <span class="co"># function parameters</span></span>
<span>                  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"numeric"</span>, description <span class="op">=</span> <span class="st">"first number"</span><span class="op">)</span>,</span>
<span>                    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"numeric"</span>, description <span class="op">=</span> <span class="st">"second number"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>                <span class="op">)</span></span>
<span>              <span class="op">)</span></span>
<span></span>
<span><span class="va">tool2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"function"</span>,</span>
<span>              <span class="st">"function"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                name <span class="op">=</span> <span class="st">"multiply_two_numbers"</span>,  <span class="co"># function name</span></span>
<span>                description <span class="op">=</span> <span class="st">"multiply two numbers"</span>,</span>
<span>                parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                  type <span class="op">=</span> <span class="st">"object"</span>,</span>
<span>                  required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>,  <span class="co"># function parameters</span></span>
<span>                  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"numeric"</span>, description <span class="op">=</span> <span class="st">"first number"</span><span class="op">)</span>,</span>
<span>                    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"numeric"</span>, description <span class="op">=</span> <span class="st">"second number"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>                <span class="op">)</span></span>
<span>              <span class="op">)</span></span></code></pre></div>
<p>Then call the <code><a href="../reference/chat.html">chat()</a></code> function with the
<code>tools</code> parameter set to a list of your tools. Pass in a
single tool.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span><span class="st">"what is three plus one?"</span><span class="op">)</span></span>
<span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="va">msg</span>, tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">tool1</span><span class="op">)</span>, output <span class="op">=</span> <span class="st">"tools"</span><span class="op">)</span></span>
<span><span class="va">tool</span> <span class="op">&lt;-</span> <span class="va">resp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>  <span class="co"># get the first tool/function</span></span>
<span></span>
<span><span class="co"># call the tool function with arguments: add_two_numbers(3, 1)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">tool</span><span class="op">$</span><span class="va">name</span>, <span class="va">tool</span><span class="op">$</span><span class="va">arguments</span><span class="op">)</span></span></code></pre></div>
<p>Pass in multiple tools. The model will pick the best tool to use
based on the context of the message.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span><span class="st">"what is three multiplied by four?"</span><span class="op">)</span></span>
<span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="va">msg</span>, tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">tool1</span>, <span class="va">tool2</span><span class="op">)</span>, output <span class="op">=</span> <span class="st">"tools"</span><span class="op">)</span></span>
<span><span class="va">tool</span> <span class="op">&lt;-</span> <span class="va">resp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>  <span class="co"># get the first tool/function</span></span>
<span></span>
<span><span class="co"># call the tool function with arguments: multiply_two_numbers(3, 4)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">tool</span><span class="op">$</span><span class="va">name</span>, <span class="va">tool</span><span class="op">$</span><span class="va">arguments</span><span class="op">)</span></span></code></pre></div>
<p>Pass in multiple tools and get the model to use multiple tools. Note
that LLM responses are inherently stochastic, so sometimes the model
might choose to call only one tool, and sometimes might call tools
multiple times.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span><span class="st">"add three plus four. then multiply by ten"</span><span class="op">)</span></span>
<span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="va">msg</span>, tools <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">tool1</span>, <span class="va">tool2</span><span class="op">)</span>, output <span class="op">=</span> <span class="st">"tools"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># first tool/function: add_two_numbers(3, 4)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">resp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">name</span>, <span class="va">resp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">arguments</span><span class="op">)</span> <span class="co"># 7</span></span>
<span><span class="co"># second tool/function: multiply_two_numbers(7, 10)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">resp</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">name</span>, <span class="va">resp</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">arguments</span><span class="op">)</span> <span class="co"># 70</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="structured-outputs">Structured outputs<a class="anchor" aria-label="anchor" href="#structured-outputs"></a>
</h3>
<p>The <code><a href="../reference/chat.html">chat()</a></code> and <code><a href="../reference/generate.html">generate()</a></code> functions support
<a href="https://ollama.com/blog/structured-outputs" class="external-link">structured
outputs</a>, making it possible to constrain a model’s output to a
specified format defined by a JSON schema (R list).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a JSON schema as a list to constrain a model's output</span></span>
<span><span class="va">format</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"object"</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"string"</span><span class="op">)</span>,</span>
<span>    capital <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"string"</span><span class="op">)</span>,</span>
<span>    languages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"array"</span>,</span>
<span>                     items <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"string"</span><span class="op">)</span></span>
<span>                     <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>  required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"capital"</span>, <span class="st">"languages"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/generate.html">generate</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="st">"tell me about Canada"</span>, output <span class="op">=</span> <span class="st">"structured"</span>, format <span class="op">=</span> <span class="va">format</span><span class="op">)</span></span>
<span></span>
<span><span class="va">msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span><span class="st">"tell me about Canada"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="va">msg</span>, format <span class="op">=</span> <span class="va">format</span>, output <span class="op">=</span> <span class="st">"structured"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parallel-requests">Parallel requests<a class="anchor" aria-label="anchor" href="#parallel-requests"></a>
</h3>
<p>For the <code><a href="../reference/generate.html">generate()</a></code> and <code><a href="../reference/chat.html">chat()</a></code>
endpoints/functions, you can specify <code>output = 'req'</code> in the
function so the functions return <code>httr2_request</code> objects
instead of <code>httr2_response</code> objects.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prompt</span> <span class="op">&lt;-</span> <span class="st">"Tell me a 10-word story"</span></span>
<span><span class="va">req</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate.html">generate</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="va">prompt</span>, output <span class="op">=</span> <span class="st">"req"</span><span class="op">)</span>  <span class="co"># returns a httr2_request object</span></span></code></pre></div>
<p>When you have multiple <code>httr2_request</code> objects in a list,
you can make parallel requests with the
<code>req_perform_parallel</code> function from the <code>httr2</code>
library. See <a href="https://httr2.r-lib.org/reference/req_perform_parallel.html" class="external-link"><code>httr2</code>
documentation</a> for details.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://httr2.r-lib.org" class="external-link">httr2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">prompt</span> <span class="op">&lt;-</span> <span class="st">"Tell me a 5-word story"</span></span>
<span></span>
<span><span class="co"># create 5 httr2_request objects that generate a response to the same prompt</span></span>
<span><span class="va">reqs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="kw">function</span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="fu"><a href="../reference/generate.html">generate</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="va">prompt</span>, output <span class="op">=</span> <span class="st">"req"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make parallel requests and get response</span></span>
<span><span class="va">resps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform_parallel.html" class="external-link">req_perform_parallel</a></span><span class="op">(</span><span class="va">reqs</span><span class="op">)</span>  <span class="co"># list of httr2_request objects</span></span>
<span></span>
<span><span class="co"># process the responses</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">resps</span>, <span class="va">resp_process</span>, <span class="st">"text"</span><span class="op">)</span>  <span class="co"># get responses as text</span></span>
<span><span class="co"># [1] "She found him in Paris."         "She found the key upstairs."</span></span>
<span><span class="co"># [3] "She found her long-lost sister." "She found love on Mars."</span></span>
<span><span class="co"># [5] "She found the diamond ring."</span></span></code></pre></div>
<p>Example sentiment analysis with parallel requests with
<code><a href="../reference/generate.html">generate()</a></code> function</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://httr2.r-lib.org" class="external-link">httr2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glue.tidyverse.org/" class="external-link">glue</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># text to classify</span></span>
<span><span class="va">texts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'I love this product'</span>, <span class="st">'I hate this product'</span>, <span class="st">'I am neutral about this product'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create httr2_request objects for each text, using the same system prompt</span></span>
<span><span class="va">reqs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">texts</span>, <span class="kw">function</span><span class="op">(</span><span class="va">text</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">prompt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Your only task/role is to evaluate the sentiment of product reviews, and your response should be one of the following:'positive', 'negative', or 'other'. Product review: {text}"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/generate.html">generate</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="va">prompt</span>, output <span class="op">=</span> <span class="st">"req"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make parallel requests and get response</span></span>
<span><span class="va">resps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform_parallel.html" class="external-link">req_perform_parallel</a></span><span class="op">(</span><span class="va">reqs</span><span class="op">)</span>  <span class="co"># list of httr2_request objects</span></span>
<span></span>
<span><span class="co"># process the responses</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">resps</span>, <span class="va">resp_process</span>, <span class="st">"text"</span><span class="op">)</span>  <span class="co"># get responses as text</span></span>
<span><span class="co"># [1] "Positive"                            "Negative."</span></span>
<span><span class="co"># [3] "'neutral' translates to... 'other'."</span></span></code></pre></div>
<p>Example sentiment analysis with parallel requests with
<code><a href="../reference/chat.html">chat()</a></code> function</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://httr2.r-lib.org" class="external-link">httr2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># text to classify</span></span>
<span><span class="va">texts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'I love this product'</span>, <span class="st">'I hate this product'</span>, <span class="st">'I am neutral about this product'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create system prompt</span></span>
<span><span class="va">chat_history</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_message.html">create_message</a></span><span class="op">(</span><span class="st">"Your only task/role is to evaluate the sentiment of product reviews provided by the user. Your response should simply be 'positive', 'negative', or 'other'."</span>, <span class="st">"system"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create httr2_request objects for each text, using the same system prompt</span></span>
<span><span class="va">reqs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">texts</span>, <span class="kw">function</span><span class="op">(</span><span class="va">text</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">messages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/append_message.html">append_message</a></span><span class="op">(</span><span class="va">text</span>, <span class="st">"user"</span>, <span class="va">chat_history</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/chat.html">chat</a></span><span class="op">(</span><span class="st">"llama3.1"</span>, <span class="va">messages</span>, output <span class="op">=</span> <span class="st">"req"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make parallel requests and get response</span></span>
<span><span class="va">resps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform_parallel.html" class="external-link">req_perform_parallel</a></span><span class="op">(</span><span class="va">reqs</span><span class="op">)</span>  <span class="co"># list of httr2_request objects</span></span>
<span></span>
<span><span class="co"># process the responses</span></span>
<span><span class="fu">bind_rows</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">resps</span>, <span class="va">resp_process</span>, <span class="st">"df"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># get responses as dataframes</span></span>
<span><span class="co"># # A tibble: 3 × 4</span></span>
<span><span class="co">#   model    role      content  created_at</span></span>
<span><span class="co">#   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;</span></span>
<span><span class="co"># 1 llama3.1 assistant Positive 2024-08-05T17:54:27.758618Z</span></span>
<span><span class="co"># 2 llama3.1 assistant negative 2024-08-05T17:54:27.657525Z</span></span>
<span><span class="co"># 3 llama3.1 assistant other    2024-08-05T17:54:27.657067Z</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hause Lin, Tawab Safi.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
